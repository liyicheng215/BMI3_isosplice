
# BMI3 IsoSplice Tool

BMI3 IsoSplice is a bioinformatics software designed for analyzing splice junctions (SJs) from long-read sequencing data. It provides a streamlined pipeline for detecting, scoring, and simplifying SJs while leveraging a Random Forest algorithm for classification.

The software is available on GitHub: [BMI3 IsoSplice Repository](https://github.com/liyicheng215/BMI3_isosplice)

---

## Table of Contents

- [Installation](#installation)
- [Execution Instructions](#execution-instructions)
- [Command Details](#command-details)
  - [findSJ Command](#findsj-command)
  - [buildDAG Command](#builddag-command)
  - [simplifyDAG Command](#simplifydag-command)
  - [scoreSJ Command](#scoresj-command)
- [Input and Output Details](#input-and-output-details)
- [Extra](#Extra)
---

## Installation

Clone the repository using the following command:

```bash
git clone https://github.com/liyicheng215/BMI3_isosplice
cd BMI3_isosplice/src
```

Ensure Python is installed along with the required dependencies (specified in the `requirements.txt` file).

---

## Execution Instructions

To run the software, ensure you have a pre-sorted BAM file. Execute the commands in sequence as follows:

1. **Run `findSJ`**:
   ```bash
   python main.py findSJ sorted.bam
   ```
2. **Run `buildDAG`**:
   ```bash
   python main.py buildDAG SJ_scores.csv --genome_length 143726002
   ```
   *(Adjust `--genome_length` based on your reference genome size.)*

3. **Run `simplifyDAG`**:
   ```bash
   python main.py simplifyDAG DAG_edge.csv
   ```

4. **Run `scoreSJ`**:
   ```bash
   python main.py scoreSJ cluster_scores.csv cluster_label.csv
   ```

---

## Command Details

### findSJ Command
- **Description**: Extracts splice junctions from an input BAM file.
- **Parameters**:
  - `input_bam` (required): Path to the input BAM file.
  - `--k` (optional, default: 8): Determines the mismatch evaluation range. Smaller values are suitable for high-quality data, while larger values handle low-quality data.

### buildDAG Command
- **Description**: Builds a directed acyclic graph (DAG) based on splice junction scores.
- **Parameters**:
  - `input_file` (required): CSV file containing SJ scores (generated by `findSJ`).
  - `--genome_length` (optional, default: 100286401 for *C. elegans*): Adjust according to the genome size.
  - `--cluster_shift` (optional, default: 8): Cluster shift value. Larger values merge distant SJ points.
  - `--gene_shift` (optional, default: 8): Gene shift value. Larger values merge distant genes.

### simplifyDAG Command
- **Description**: Simplifies the DAG by labeling edges based on confidence.
- **Parameters**:
  - `input_file` (required): CSV file containing SJ data (generated by `buildDAG`).
  - `--thres` (optional, default: 0.01): Threshold for labeling edges as 0.
  - `--thres_dominant` (optional, default: 0.99): Threshold for labeling dominant edges as 1.
  - Larger `--thres` values increase 0 labels, while smaller `--thres_dominant` values increase 1 labels. Aim for a 2%-5% ratio of 0-labels.

### scoreSJ Command
- **Description**: Scores and classifies SJs using a Random Forest algorithm.
- **Parameters**:
  - `csv_file`, `csv_label` (required): Input CSV files containing SJ cluster data and labels (generated by `simplifyDAG`).
  - `--split` (optional, default: None): If a threshold (0-1) is specified, the output will include a `Score_label` column where values above the threshold are labeled as 1 and below are labeled as 0.

---

## Input and Output Details

1. **findSJ**:
   - **Input**: Aligned BAM file.
   - **Output**: `SJ_scores.csv` (containing SJ data).

2. **buildDAG**:
   - **Input**: `SJ_scores.csv`.
   - **Output**: `cluster_score.csv`, `DAG_edge.csv`.

3. **simplifyDAG**:
   - **Input**: `DAG_edge.csv`.
   - **Output**: `cluster_label.csv`.

4. **scoreSJ**:
   - **Input**: `cluster_score.csv`, `cluster_label.csv`.
   - **Output**: `scored_cluster_score.csv`.

---

## Extra
You can use the .sh file in isosplice/data to generate yasim stimulated data
You can use the .py file in isosplice/benchmark to look at the benchmark of the output
